@model ASM_UI.Models.asset_registrationViewModel

@{
    ViewBag.Title = "New Asset Registration";
}
<div id="content">
    <div class="row">
        <div class="col-xs-12 col-sm-9 col-md-9 col-lg-9">
            <h1 class="page-title txt-color-blueDark">

                <!-- PAGE HEADER -->
                <i class="fa-fw fa fa-pencil-square-o"></i>
                Registration
                <span>
                    >
                    Asset Registration Form
                </span>
            </h1>
        </div>
    </div>

    <section id="widget-grid" class="">
        <div class="row">
            <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="jarviswidget" id="wid-id-3" data-widget-editbutton="false" data-widget-custombutton="false" data-widget-togglebutton="false" data-widget-collapsed="false">
                    <header>
                        <span class="widget-icon"> <i class="fa fa-edit"></i> </span>
                        <h2>Registration Asset </h2>

                    </header>
                    <!-- widget div-->
                    <div>

                        <!-- widget edit box -->
                        <div class="jarviswidget-editbox">
                            <!-- This area used as dropdown edit box -->

                        </div>
                        <!-- end widget edit box -->
                        <!-- widget content -->
                        <div class="widget-body no-padding">

                            @using (Html.BeginForm("Create", "asset_registration", FormMethod.Post, htmlAttributes: new { id = "asset_registration_form", @class = "smart-form", enctype = "multipart/form-data" }))
                            {
                                <header>
                                    Registration Asset Form
                                </header>

                                <fieldset>

                                    <fieldset>
                                        @Html.AntiForgeryToken()
                                        <br />
                                        @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                                        @Html.HiddenFor(model => model.asset_type_id)
                                        @*<section>
                                                <div class="row">
                                                    <div class="col-md-1">
                                                    </div>
                                                    <div class="col-md-2">
                                                        @Html.LabelFor(model => model.asset_type_id, htmlAttributes: new { @class = "control-label" })
                                                    </div>
                                                    <div class="col-md-8">
                                                        <label class="input">
                                                            @Html.EditorFor(model => model.asset_type_id, new { htmlAttributes = new { @class = "form-control" } })
                                                            @Html.ValidationMessageFor(model => model.asset_type_id, "", new { @class = "text-danger" })
                                                        </label>
                                                    </div>
                                                    </div>
                                            </section>*@

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_number, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_number, new { htmlAttributes = new { @class = "form-control", @readonly = "true", placeholder = "Auto" } })
                                                        @Html.ValidationMessageFor(model => model.asset_number, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.company_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.company_id, new SelectList(Model.company_list, "company_id", "company_name"), "- Select Company -", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.company_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_reg_location_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.asset_reg_location_id, new SelectList(Model.asset_reg_location_list, "asset_reg_location_id", "asset_reg_location_name"), "-Select Asset Reg Location-", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.asset_reg_location_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_reg_pic_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.asset_reg_pic_id, new SelectList(Model.asset_reg_pic_list, "asset_reg_pic_id", "asset_reg_pic_name"), "-Select Asset Reg PIC-", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.asset_reg_pic_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.category_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.category_id, new SelectList(Model.asset_category_list, "category_id", "category_name"), "- Select Category -", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.category_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_receipt_date, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @{var asset_receipt_date = string.Format("{0:dd-MM-yyyy}", Model.asset_receipt_date); }
                                                        @Html.EditorFor(model => asset_receipt_date, new { htmlAttributes = new { @class = "form-control", id = "asset_receipt_date" } })
                                                        @Html.ValidationMessageFor(model => model.asset_receipt_date, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                    </fieldset>

                                    <fieldset title="Asset Detail Information">

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_po_number, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_po_number, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.asset_po_number, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_do_number, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_do_number, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.asset_do_number, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_name, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_name, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.asset_name, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_merk, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_merk, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.asset_merk, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_serial_number, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-3">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_serial_number, new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.asset_serial_number, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>

                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-1">@Html.LabelFor(model => model.asset_quantity, htmlAttributes: new { @class = "control-label" })</div>
                                                <div class="col-md-3">
                                                    <label class="input">
                                                        @Html.EditorFor(model => model.asset_quantity, "1", new { htmlAttributes = new { @class = "form-control" } })
                                                        @Html.ValidationMessageFor(model => model.asset_quantity, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>

                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_description, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    @Html.TextAreaFor(model => model.asset_description, 5, 104, new { htmlAttributes = new { @class = "form-control" } })
                                                    @*<textarea name="asset_description" rows="5" class="form-control" placeholder="Description or specification"></textarea>*@
                                                    @Html.ValidationMessageFor(model => model.asset_description, "", new { @class = "text-danger" })

                                                </div>

                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.vendor_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.vendor_id, new SelectList(Model.vendor_list, "vendor_id", "vendor_name"), "- Select Vendor -", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.vendor_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>


                                    </fieldset>

                                    <fieldset title="Location">

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.location_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.location_id, new SelectList(Model.asset_location_list, "location_id", "location_name"), "- Select Location -", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.location_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.department_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.department_id, new SelectList(Model.department_list, "department_id", "department_name"), "- Select Department -", htmlAttributes: new { @class = "form-control select2" })
                                                        @Html.ValidationMessageFor(model => model.department_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.employee_id, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        @Html.DropDownListFor(model => model.employee_id, new SelectList(Model.employee_list, "employee_id", "employee_name"), "- Select Employee -", htmlAttributes: new { @class = "form-control select2" })
                                                        @*@Html.DropDownListFor(model=>model.employee_id, Model.employee_list, "Select Employee", new { data_url = Url.Action("GetEmployeeByDepartment") })*@
                                                        @Html.ValidationMessageFor(model => model.employee_id, "", new { @class = "text-danger" })
                                                    </label>
                                                </div>
                                            </div>
                                        </section>

                                    </fieldset>

                                    <fieldset title="Image">
                                        <section>
                                            <div class="row">
                                                <div class="col-md-1">
                                                </div>
                                                <div class="col-md-2">
                                                    @Html.LabelFor(model => model.asset_img_file, htmlAttributes: new { @class = "control-label" })
                                                </div>
                                                <div class="col-md-8">
                                                    <label class="input">
                                                        <span class="input-group-btn">
                                                            <span class="btn btn-default btn-file">
                                                                Browse asset image ( *.jpg | *.gif | *.png )
                                                                @Html.TextBoxFor(model => model.asset_img_file, new { type = "file", @class = "form-control" })
                                                            </span>
                                                        </span>

                                                    </label>
                                                </div>
                                            </div>
                                        </section>
                                    </fieldset>

                                </fieldset>

                                <footer>
                                    <div class="form-group">
                                        <div class="col-md-7">
                                            @Html.ActionLink("Cancel", "Index", "asset_registration", htmlAttributes: new { id = "CancelAsset", @class = "btn btn-default" })
                                            <input type="button" value="Save" class="btn btn-primary" id="SaveAsset" onclick="Save()" />
                                        </div>
                                    </div>
                                </footer>
                            }
                        </div>
                    </div>
                </div>
            </article>

        </div>
    </section>
</div>

@section pagespecific {
    <script type="text/javascript">
        $(document).ready(function () {

            $('#asset_receipt_date').datepicker({
                dateFormat: 'dd-mm-yy',
                prevText: '<i class="fa fa-chevron-left"></i>',
                nextText: '<i class="fa fa-chevron-right"></i>',
            });


            //$("#department_id").change(function () {
            //    var compid = $("#company_id").val();
            //    var depid = $(this).val();

            //    var url = $("#department_id").data("url") + '?compid=' + compid + '&depid=' + depid;
            //    var $ddl_emp = $("#employee_id");

            //    $.getJSON(url, function (data) {
            //        $ddl_emp.empty();
            //        $.each(data, function (i, item) {
            //            $ddl_emp.append($("<option>").text(item.Text).val(item.Value));
            //        });
            //    });
            //});

            //Dropdownlist Selectedchange event
            $("#department_id").change(function () {
                $("#employee_id").empty();
                $("#employee_id").append('<option value="">- Select Employee -</option>');
                //alert($("#location_id").val());
                $.ajax({
                    type: 'POST',

                    url: '/asset_registration/GetEmployeeByDepartment', // we are calling json method

                    dataType: 'json',

                    data: { deptid: $("#department_id").val(), locid: $("#location_id").val() },

                    success: function (employee_list) {

                        $.each(employee_list, function (i, employee) {
                            $("#employee_id").append('<option value="' + employee.Value + '">' + employee.Text + '</option>');

                        });
                    },
                    error: function (ex) {
                        var deptid = $("#department_id").val();
                        if (!deptid)
                            alert('Please select Department');
                        else
                            alert('Failed to retrieve employee.' + ex);
                    }
                });
                return false;
            })


            $("asset_quantity").change(function () {
                var qty = $(this).val();
                var dept_ctl = $("#department_id");
                var emp_ctl = $("#employee_id");

                if (eval(qty) <= 1 || !qty) {
                    dept_ctl.enable = true;
                    emp_ctl.enable = true;
                    if (!dept_ctl.val) { alert('Please select Department'); return false; }
                    if (!emp_ctl.val) { alert('Please select Employee'); return false; }
                }
                else {
                    dept_ctl.enable = false;
                    emp_ctl.enable = false;
                    dept_ctl.val = "";
                    emp_ctl.val = "";
                }

            });

        });

        /*var asset_reg_pic = $("#asset_registration_form").validate({
            rules: {
                asset_reg_pic_id: "required"
            }
        });
        $(document).on("change", "#asset_reg_pic_id", function () {
            asset_reg_pic.form();
        });*/

        function Save() {
            //ValidateForm();
            var $asset_regForm = $("#asset_registration_form").validate({
                // Rules for form validation
                rules: {
                    company_id: {
                        required: true,
                    },
                    asset_reg_location_id: {
                        required: true,
                    },
                    asset_reg_pic_id: {
                        required: true,
                    },
                    category_id: {
                        required: true,
                    },
                    asset_receipt_date: {
                        required: true
                    },
                    asset_name: {
                        required: true
                    },
                    asset_description: {
                        required: true
                    },
                    asset_quantity: {
                        required: true
                    },
                    asset_img_file: {
                        required: true
                    }
                },

                // Messages for form validation
                messages: {
                    company_id: {
                        required: 'Please select company'
                    },
                    asset_reg_location_id: {
                        required: 'Please select register location'
                    },
                    asset_reg_pic_id: {
                        required: 'Please select register pic'
                    },
                    category_id: {
                        required: 'Please select category'
                    },
                    asset_receipt_date: {
                        required: 'Please input receipt date'
                    },
                    asset_name: {
                        required: 'Please input asset name'
                    },
                    asset_description: {
                        required: 'Please input asset description'
                    },
                    asset_quantity: {
                        required: 'Please input asset quantity'
                    },
                    asset_img_file: {
                        required: 'Please select image to upload'
                    },
                },

                // Do not change code below
                errorPlacement: function (error, element) {
                    error.insertAfter(element.parent());
                }
            });
            $(document).on("change", "#asset_reg_pic_id", function () {
                $asset_regForm.form();
            });
            $(document).on("change", "#category_id", function () {
                $asset_regForm.form();
            });
            if ($("#asset_registration_form").valid()) {
                swal({
                    title: "Are you sure you have entried valid data?",
                    type: "info",
                    showCancelButton: true,
                    confirmButtonColor: "#1fdd48",
                    cancelButtonColor: '#d33',
                    confirmButtonText: "Yes, Continue!",
                    cancelButtonClass: 'btn btn-danger',
                    closeOnConfirm: false,
                    closeOnEsc: false,
                    closeOnCancel: false,
                    showLoaderOnConfirm: true,
                    preConfirm: () => {
                        return new Promise(() => {
                            //ajax side
                            var urlSave = '/asset_registration/SaveAsset/';
                            var form = $('#asset_registration_form')[0];
                            var formData = new FormData(form);

                            $.ajax({
                                type: 'POST',
                                processData: false,
                                contentType: false,
                                url: urlSave,
                                //data: $("#asset_registration_form").serialize(),
                                data: formData,
                                success: function (result) {
                                    //alert(result);
                                    $('#Save').prop('disabled', true);
                                    $('#Cancel').prop('disabled', true);
                                    /* ---------------
                                    swal({
                                        title: "Success",
                                        text: result,
                                        type: "success"
                                    });

                                    ------ */
                                    /*--------
                                    setTimeout(function () {
                                        swal({
                                            title: "Success",
                                            text: "Success",
                                            type: "success"
                                        }, function () {
                                            window.location = "/asset_registration/";
                                        });
                                    }, 1000);
                                    --------------------- */

                                    swal({
                                        title: "Success",
                                        text: "Asset Registration has been succssfully saved",
                                        type: "success"
                                    },
                                        {
                                            buttons: {
                                                finish_rec: "OK Finish.",
                                                new_rec: {
                                                    text: "Create New",
                                                    value: "new_rec",
                                                },
                                            },
                                        })
                                        .then((value) => {
                                            switch (value) {

                                                case "new_rec":
                                                    window.location = "/asset_registration/create";
                                                    break;

                                                default:
                                                    window.location = "/asset_registration/";
                                            }
                                        });
                                },
                                error: function (data) {
                                    swal("Error", "Error Save Asset", "error");
                                }
                            });

                            /* ------------------ajax kedua jika ingin dipisah save data dan save file ------------------
                            var url = "/asset_registration/SaveAsset/";
                            var form = $('#asset_registration_form')[0];
                            var formData = new FormData(form);

                            $.ajax(url, {
                                method: 'post',
                                processData: false,
                                contentType: false,
                                data: formData
                            }).done(function (data) {
                                if (data.success) {
                                    //alert("Files uploaded");
                                    swal({
                                        title: "Success",
                                        text: result,
                                        type: "success"
                                    });

                                    $('#SaveAsset').prop('disabled', true);
                                    $('#CancelAsset').prop('disabled', true);
                                } else {
                                    //alert("Error while uploading the files");
                                    swal("Error", "Error Save Asset", "error");
                                }
                            }).fail(function (data) {
                                console.log(data);
                                //alert("Error while uploading the files");
                            });
                            */
                        })
                    },
                    allowOutsideClick: () => !swal.isLoading()
                }).then((result) => {
                    if (result.dismiss) {
                        swal("Cancel", "You Cancel Process Finish Registration", "error");
                    }
                });

            }
            else {
                swal({
                    title: "Validation Error",
                    text: "Please check your input data...",
                    type: "warning"
                });
                var validator = $("#asset_registration_form").validate();
                validator.form();
            }
        }
    </script>
}
